<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Json2Thrift 字段合并测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        .input-section, .output-section {
            flex: 1;
        }
        textarea {
            width: 100%;
            height: 300px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ccc;
            padding: 10px;
            resize: vertical;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            margin: 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .test-case h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .test-case button {
            background: #28a745;
            font-size: 12px;
            padding: 5px 10px;
        }
        .test-case button:hover {
            background: #1e7e34;
        }
    </style>
</head>
<body>
    <h1>Json2Thrift 字段合并功能测试</h1>
    
    <div class="container">
        <div class="input-section">
            <h3>JSON 输入</h3>
            <textarea id="jsonInput" placeholder="请输入JSON数据..."></textarea>
            <br>
            <button onclick="convertToThrift()">转换为 Thrift</button>
            
            <div class="test-case">
                <h4>测试用例：字段合并</h4>
                <p>数组元素包含不同字段的情况</p>
                <button onclick="loadTestCase()">加载测试数据</button>
            </div>
        </div>
        
        <div class="output-section">
            <h3>Thrift IDL 输出</h3>
            <textarea id="thriftOutput" readonly placeholder="转换结果将显示在这里..."></textarea>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // 测试数据
        const testData = {
            "users": [
                {
                    "id": 1,
                    "name": "张三",
                    "email": "zhangsan@example.com",
                    "age": 25
                },
                {
                    "id": 2,
                    "name": "李四",
                    "phone": "13800138000",
                    "department": "技术部"
                },
                {
                    "id": 3,
                    "name": "王五",
                    "email": "wangwu@example.com",
                    "phone": "13900139000",
                    "age": 30,
                    "isManager": true
                }
            ]
        };

        function loadTestCase() {
            document.getElementById('jsonInput').value = JSON.stringify(testData, null, 2);
        }

        function convertToThrift() {
            const jsonInput = document.getElementById('jsonInput').value;
            const thriftOutput = document.getElementById('thriftOutput');
            
            try {
                const jsonData = JSON.parse(jsonInput);
                const converter = new Json2Thrift();
                const result = converter.convertToThrift(jsonData);
                thriftOutput.value = result;
                
                // 验证结果
                console.log('转换完成！');
                console.log('输入:', jsonData);
                console.log('输出:', result);
                
                // 检查是否包含所有预期字段
                if (jsonData.users) {
                    const expectedFields = ['id', 'name', 'email', 'age', 'phone', 'department', 'isManager'];
                    const missingFields = expectedFields.filter(field => !result.includes(field));
                    
                    if (missingFields.length === 0) {
                        console.log('✓ 所有字段都已正确合并');
                    } else {
                        console.log('✗ 缺失字段:', missingFields);
                    }
                }
                
            } catch (error) {
                thriftOutput.value = '错误: ' + error.message;
                console.error('转换错误:', error);
            }
        }

        // 页面加载时自动加载测试数据
        window.onload = function() {
            loadTestCase();
            console.log('测试页面已加载，点击"转换为 Thrift"按钮进行测试');
        };
    </script>
</body>
</html>
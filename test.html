<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>错误修复测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>JSON转Thrift错误修复测试</h1>
    
    <div class="test-section">
        <h3>测试1: 缺失容器元素的情况</h3>
        <button onclick="testMissingContainer()">测试缺失容器</button>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h3>测试2: 正常容器元素的情况</h3>
        <div id="normalContainer"></div>
        <button onclick="testNormalContainer()">测试正常容器</button>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h3>测试3: Toast消息测试</h3>
        <div id="toast" class="toast"></div>
        <button onclick="testToast()">测试Toast</button>
        <div id="test3-result"></div>
    </div>

    <script src="tree-editor-v2.js"></script>
    <script>
        function testMissingContainer() {
            const resultDiv = document.getElementById('test1-result');
            try {
                // 尝试创建一个使用不存在容器的树编辑器
                const editor = new ThriftTreeEditorV2('nonExistentContainer');
                resultDiv.innerHTML = '<span class="success">✓ 成功处理缺失容器，没有抛出错误</span>';
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">✗ 仍然抛出错误: ${error.message}</span>`;
            }
        }
        
        function testNormalContainer() {
            const resultDiv = document.getElementById('test2-result');
            try {
                // 使用存在的容器创建树编辑器
                const editor = new ThriftTreeEditorV2('normalContainer');
                resultDiv.innerHTML = '<span class="success">✓ 成功创建树编辑器</span>';
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">✗ 创建失败: ${error.message}</span>`;
            }
        }
        
        function testToast() {
            const resultDiv = document.getElementById('test3-result');
            try {
                // 模拟Json2Thrift类的showToast方法
                const mockApp = {
                    toast: document.getElementById('toast'),
                    showToast: function(message, type = 'success') {
                        if (!this.toast) {
                            console.error('Toast元素不存在，无法显示消息:', message);
                            return;
                        }
                        
                        this.toast.textContent = message;
                        this.toast.className = `toast ${type}`;
                        this.toast.style.display = 'block';
                        this.toast.style.padding = '10px';
                        this.toast.style.backgroundColor = type === 'error' ? '#f44336' : '#4CAF50';
                        this.toast.style.color = 'white';
                        this.toast.style.borderRadius = '4px';
                        
                        setTimeout(() => {
                            if (this.toast) {
                                this.toast.style.display = 'none';
                            }
                        }, 3000);
                    }
                };
                
                mockApp.showToast('测试消息', 'success');
                resultDiv.innerHTML = '<span class="success">✓ Toast消息显示成功</span>';
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">✗ Toast测试失败: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>